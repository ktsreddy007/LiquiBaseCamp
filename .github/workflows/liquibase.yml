name: Liquibase Migration
on: 
  workflow_dispatch:
    inputs:
      target_env:
        description: "Target environment (dev/qa/demo)"
        required: true
        default: dev
        type: choice
        options:
          - dev
          - qa
          - demo
      runner_group:
        description: 'Select Runner Group'
        required: false
        type: choice
        options:
          - NA    
      services:
        description: "Optional - Please type Comma-separated list of services to run (default: all)"
        required: false
      schema_config:
        description: "Optional - Please Select Schema Config Yaml file to run for manual trigger in config/ folder"
        required: false
        default: schema-config-dev.yml
        type: choice
        options:
          - schema-config-dev.yml
          - schema-config-qa.yml
          - schema-config-demo.yml
      selected_schemas:
        description: "Optional - Please Select Comma-separated list of schemas to run (default: all)"
        required: false
        default: ""
        type: string  
jobs:
  liquibase:
    runs-on: ubuntu-latest   # GitHub-hosted runner
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: Run Liquibase Update
        uses: liquibase/liquibase-github-action@v4
        with:
          operation: update
          changeLogFile: liquibase/changelog.xml
          url: ${{ secrets.DB_URL }}
          username: ${{ secrets.DB_USERNAME }}
          password: ${{ secrets.DB_PASSWORD }}    