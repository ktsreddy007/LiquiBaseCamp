steps:
  - script: |
      set -euo pipefail
      echo "=== LIQUIBASE VALIDATE ==="

      # Detect changelog dynamically
      if [ -f "DML/changelog/master.xml" ]; then
          CHANGELOG="DML/changelog/master.xml"
      elif [ -f "DDL/changelog/master.xml" ]; then
          CHANGELOG="DDL/changelog/master.xml"
      else
          echo "ERROR: Changelog file not found"
          exit 1
      fi
      echo "Using changelog file: $CHANGELOG"

      liquibase validate \
        --defaultsFile=config/liquibase.properties \
        --changeLogFile=$CHANGELOG \
        --username="$DB_USERNAME" \
        --password="$DB_PASSWORD" \
        --url="$DB_URL"

      echo "Validation successful."
    displayName: "Liquibase Validate"
    env:
      DB_URL: $(DB_URL)
      DB_USERNAME: $(DB_USERNAME)
      DB_PASSWORD: $(DB_PASSWORD)
      LIQUIBASE_HOME: $(LIQUIBASE_HOME)
          